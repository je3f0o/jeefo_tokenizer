/**
 * jeefo_tokenizer : v0.0.12
 * Author          : je3f0o <je3f0o@gmail.com>
 * Homepage        : https://github.com/je3f0o/jeefo_tokenizer
 * License         : The MIT license
 * Copyright       : 2017
 **/
!function(e,t,n){"use strict";!function(e){var t=e.module("jeefo_core",[]),n=function(e){return function(t,n,r,i){return"function"===typeof n?(i=r,r=n,n=[]):"string"===typeof n&&(n=[n]),void 0===i&&(i=!0),e.call(this,t,{fn:r,dependencies:n,resolve_once:i})}},r=function(e){var t=function(t,n){return(n?e:"")+t.toLowerCase()};return function(){return this.replace(/[A-Z]/g,t)}};String.prototype.dash_case=r("-"),String.prototype.snake_case=r("_"),t.extend("curry",["$injector"],function(e){return n(function(t,n){e.register((t+"Curry").snake_case(),n)})}),t.curry("makeInjectable",function(){return n}),t.extend("run",["$injector"],function(e){var t=Array;return function(n,r){var i,s,o=0;if("function"===typeof n)r=n,s=[];else if("string"===typeof n)s=[e.resolve_sync(n)];else for(o=0,i=n.length,s=new t(i);o<i;++o)s[o]=e.resolve_sync(n[o]);return r.apply(this,s)}}),t.extend("namespace",["$injector","make_injectable_curry"],function(e,t){return t(function(t,n){for(var r,i,s=t.split("."),o=s.pop(),c=0,h=s.length,a="";c<h;++c)r=s[c],a&&(i=e.resolve_sync(a)),a=a?a+"."+r:r,e.has(a)||(e.register(a,{dependencies:[],resolve_once:!0,fn:function(){return{}}}),i&&(i[r]=e.resolve_sync(a)));e.register(t,n),a&&(i=e.resolve_sync(a),i[o]=e.resolve_sync(t))})}),t.extend("factory",["$injector","make_injectable_curry"],function(e,t){return t(function(t,n){e.register((t+"Factory").snake_case(),n)})}),t.extend("service",["$injector","make_injectable_curry"],function(e,t){return t(function(t,n){n.is_constructor=!0,e.register((t+"Service").snake_case(),n)})})}(e);var r=function(e){for(var t in e)this[t]=e[t]},i=r.prototype;i.error=function(e){var t=new SyntaxError(e);throw t.token=this.value,t.lineNumber=this.start.line,t.columnNumber=this.start.column,t},i.error_unexpected_type=function(){this.error("Unexpected "+this.type)},i.error_unexpected_token=function(){this.error("Unexpected token")};var s=function(e){this.type=e.type,this.name=e.name,this.start=e.start,this.end=e.end,e.skip&&(this.skip=e.skip),e.until&&(this.until=e.until),e.ignore&&(this.ignore=e.ignore),e.keepend&&(this.keepend=e.keepend),e.contains&&(this.contains=e.contains),e.contained&&(this.contained=e.contained),e.ignore&&(this.ignore_chars=this.find_special_characters(e.ignore)),e.contains&&(this.contains_chars=this.find_special_characters(e.contains))};i=s.prototype,i.RegionDefinition=s,i.copy=function(){return new this.RegionDefinition(this)},i.find_special_characters=function(e){for(var t=0;t<e.length;++t)if("SpecialCharacter"===e[t].type)return e[t].chars.join("")};var o=function(e){this.hash={},this.language=e,this.global_null_regions=[],this.contained_null_regions=[]};i=o.prototype,i.sort_function=function(e,t){return e.start.length-t.start.length},i.register=function(e){if(e=new s(e),e.start)this.hash[e.start[0]]?(this.hash[e.start[0]].push(e),this.hash[e.start[0]].sort(this.sort_function)):this.hash[e.start[0]]=[e];else if(e.contained)this.contained_null_regions.push(e);else{if(this.global_null_region)throw Error("Overwritten global null region.");this.global_null_region=e}},i.find=function(e,t){var n,r,i,s=0,o=this.hash[t.current()];if(e&&e.contains){if(o)e:for(s=o.length-1;s>=0;--s)for(r=e.contains.length-1;r>=0;--r)if(o[s].type===e.contains[r].type){for(i=1,n=o[s].start;i<n.length;++i)if(t.peek(t.current_index+i)!==n[i])continue e;return o[s].copy()}for(s=e.contains.length-1;s>=0;--s)for(r=this.contained_null_regions.length-1;r>=0;--r)if(this.contained_null_regions[r].type===e.contains[s].type)return this.contained_null_regions[r].copy()}else{if(o)e:for(s=o.length-1;s>=0;--s)if(!o[s].contained){for(i=1,n=o[s].start;i<n.length;++i)if(t.peek(t.current_index+i)!==n[i])continue e;return o[s].copy()}if(this.global_null_region)return this.global_null_region.copy()}};var c=function(e){this.string=e,this.current_index=0};i=c.prototype,i.peek=function(e){return this.string.charAt(e)},i.seek=function(e,t){return this.string.substring(e,e+t)},i.next=function(){return this.peek(this.current_index+=1)},i.current=function(){return this.peek(this.current_index)};var h=function(e,t){this.lines=[{number:1,index:0}],this.start={line:1,column:1},this.tokens=[],this.stack=[],this.regions=t,this.language=e};i=h.prototype,i.is_array=Array.isArray,i.parse=function(e){for(var t,n=this.streamer=new c(e),r=n.current();r;){if(this.current_region){if(this.current_region.ignore_chars&&-1!==this.current_region.ignore_chars.indexOf(r)){r=n.next();continue}if(this.region_end(this.current_region)){this.current_token=this.current_token.parent,this.current_region=this.current_region.parent,r=n.next();continue}}t=this.regions.find(this.current_region,n),t?(this.parse_region(t),t.keepend&&this.stack.push({token:this.current_token,region:t})):r<=" "?this.handle_new_line(r):r>="0"&&r<="9"?this.parse_number():-1===this.SPECIAL_CHARACTERS.indexOf(r)?this.parse_identifier():this.parse_special_character(),r=n.next()}return this.tokens},i.parse_number=function(){var e,t=this.streamer;for(this.prepare_new_token(t.current_index),e=t.next();e>="0"&&e<="9";e=t.next());this.add_token(this.make_token("Number")),this.streamer.current_index-=1},i.SPECIAL_CHARACTERS=[",",".",";",":","<",">","~","`","!","@","#","|","%","^","&","*","(",")","-","+","=","[","]","/","?",'"',"{","}","_","'","\\"].join(""),i.parse_identifier=function(){var e,t=this.streamer;for(this.prepare_new_token(t.current_index),e=t.next();e>" "&&-1===this.SPECIAL_CHARACTERS.indexOf(e);e=t.next());this.add_token(this.make_token("Identifier")),t.current_index-=1},i.parse_region=function(e){var t,n,r,i,s=e.skip,o=this.streamer;if(this.prepare_new_token(o.current_index),e.start_length=e.start?e.start.length:0,e.start_length&&(o.current_index+=e.start_length),e.contains)return i=this.make_token(e.type),i.children=[],this.current_token?(e.parent=this.current_region,i.parent=this.current_token,this.current_token.children.push(i)):this.tokens.push(i),this.current_token=i,this.current_region=e,void(e.start_length&&(o.current_index-=1));for(r=o.current();r;){if(this.handle_new_line(r),s&&r===s[0]){for(n=!0,t=1;t<s.length;++t)if(o.peek(o.current_index+t)!==s[t]){n=!1;break}if(n){o.current_index+=s.length,r=o.peek(o.current_index);continue}}if(this.region_end(e,!0))return;r=o.next()}},i.parse_special_character=function(){!this.current_region||this.current_region.contains_chars&&-1!==this.current_region.contains_chars.indexOf(this.streamer.current())||(this.prepare_new_token(this.streamer.current_index),this.streamer.current_index+=1,this.make_token("SpecialCharacter").error_unexpected_token()),this.prepare_new_token(this.streamer.current_index),this.streamer.current_index+=1,this.add_token(this.make_token("SpecialCharacter")),this.streamer.current_index-=1},i.region_end=function(e,t){var n=0;if(this.is_array(e.end))for(;n<e.end.length;++n)if(this.check_end_token(e,e.end[n],t))return this.finallzie_region(e),!0;return this.check_end_token(e,e.end,t)?(this.finallzie_region(e),!0):!!this.region_end_stack(e,t)||void 0},i.finallzie_region=function(e){for(var t=0;t<this.stack.length;++t)this.stack[t].region===e&&(this.current_token=this.stack[t].token,this.current_region=this.stack[t].region,this.stack.splice(t,this.stack.length))},i.region_end_stack=function(e,t){for(var n,r=this.stack.length-1;r>=0;--r)if(this.is_array(this.stack[r].region.end)){for(n=0;n<this.stack[r].region.end.length;++n)if(this.check_end_token(e,this.stack[r].region.end[n],t))return this.finallzie_region(this.stack[r].region),!0}else if(this.check_end_token(e,this.stack[r].region.end,t))return this.finallzie_region(this.stack[r].region),!0},i.check_end_token=function(e,t,n){var r=1,i=this.streamer;if(i.peek(i.current_index)===t[0]){for(;r<t.length;++r)if(i.peek(i.current_index+r)!==t[r])return!1;return n&&this.add_token(this.make_token(e.type,e.name,this.start.index+e.start_length,i.current_index-this.start.index-e.start_length)),e.until||(i.current_index+=t.length),this.current_token&&(this.set_end(this.current_token),this.set_value(this.current_token)),i.current_index-=1,!0}},i.handle_new_line=function(e){"\r"!==e&&"\n"!==e||this.new_line()},i.new_line=function(){this.lines.push({number:this.lines.length+1,index:this.streamer.current_index+1})},i.set_value=function(e){e.value=this.streamer.seek(e.start.index,e.end.index-e.start.index)},i.set_end=function(e){e.end={line:this.lines.length,column:this.streamer.current_index-this.lines[this.lines.length-1].index+1,index:this.streamer.current_index}},i.prepare_new_token=function(e){this.start={line:this.lines.length,column:e-this.lines[this.lines.length-1].index+1,index:e}},i.add_token=function(e){this.current_token?(this.set_end(this.current_token),this.set_value(this.current_token),this.current_token.children.push(e)):this.tokens.push(e)},i.make_token=function(e,t,n,i){return void 0===n&&(n=this.start.index,i=this.streamer.current_index-this.start.index),new r({type:e,name:t||e,value:this.streamer.seek(n,i),start:this.start,end:{line:this.lines.length,column:this.streamer.current_index-this.lines[this.lines.length-1].index+1,index:this.streamer.current_index}})};var a=e.module("jeefo_tokenizer",["jeefo_core"]);a.namespace("tokenizer.Token",function(){return r}),a.namespace("tokenizer.Region",function(){return o}),a.namespace("tokenizer.TokenParser",function(){return h})}(window.jeefo,window,document);