/**
 * jeefo_tokenizer : v0.0.24
 * Author          : je3f0o, <je3f0o@gmail.com>
 * Homepage        : https://github.com/je3f0o/jeefo_tokenizer
 * License         : The MIT License
 * Copyright       : 2017
 **/
!function(e,t,n){"use strict";e.use(function(e){var t,n=e.module("jeefo_tokenizer",["jeefo_core"]).run("JeefoObject",function(e){t=e}),i=function(){};i.prototype={error:function(e){var t=new SyntaxError(e);throw t.value=this.value,t.lineNumber=this.start.line,t.columnNumber=this.start.column,t},error_unexpected_type:function(){this.error("Unexpected "+this.type)},error_unexpected_token:function(){this.error("Unexpected token")}};var r=function(e){this.type=e.type,this.name=e.name||e.type,this.start=e.start,this.end=e.end,e.skip&&(this.skip=e.skip),e.until&&(this.until=e.until),e.keepend&&(this.keepend=e.keepend),e.contains&&(this.contains=e.contains),e.contained&&(this.contained=e.contained),e.escape_char&&(this.escape_char=e.escape_char),e.contains&&(this.contains_chars=this.find_special_characters(e.contains))};r.prototype={RegionDefinition:r,copy:function(){return new this.RegionDefinition(this)},find_special_characters:function(e){for(var t=e.length-1;t>=0;--t)if("SpecialCharacter"===e[t].type)return e[t].chars.join("")}};var s=function(e){this.hash=e||new t,this.global_null_regions=[],this.contained_null_regions=[]};s.prototype={Regions:s,RegionDefinition:r,$copy:function(){return new this.Regions(this.hash.$copy())},sort_function:function(e,t){return e.start.length-t.start.length},register:function(e){if(e=new this.RegionDefinition(e),e.start)this.hash[e.start[0]]?(this.hash[e.start[0]].push(e),this.hash[e.start[0]].sort(this.sort_function)):this.hash[e.start[0]]=[e];else if(e.contained)this.contained_null_regions.push(e);else{if(this.global_null_region)throw new Error("Overwritten global null region.");this.global_null_region=e}return this},find:function(e,t){var n,i,r,s=0,h=this.hash[t.current()];if(e&&e.contains){if(h)e:for(s=h.length-1;s>=0;--s)for(i=e.contains.length-1;i>=0;--i)if(h[s].type===e.contains[i].type){for(n=h[s].start,r=n.length-1;r>=1;--r)if(t.peek(t.current_index+r)!==n.charAt(r))continue e;return h[s].copy()}for(s=e.contains.length-1;s>=0;--s)for(i=this.contained_null_regions.length-1;i>=0;--i)if(this.contained_null_regions[i].type===e.contains[s].type)return this.contained_null_regions[i].copy()}else{if(h)e:for(s=h.length-1;s>=0;--s)if(!h[s].contained){for(n=h[s].start,r=n.length-1;r>=1;--r)if(t.peek(t.current_index+r)!==n.charAt(r))continue e;return h[s].copy()}if(this.global_null_region)return this.global_null_region.copy()}}};var h=function(e){this.string=e,this.current_index=0};h.prototype={peek:function(e){return this.string.charAt(e)},seek:function(e,t){return this.string.substring(e,e+t)},next:function(){return this.peek(++this.current_index)},current:function(){return this.peek(this.current_index)}};var o=function(){this.start={line:1,column:1},this.lines=[{number:1,index:0}],this.stack=[],this.tokens=[]};o.prototype={is_array:Array.isArray,parse:function(e,t){var n,i=e.current();for(this.streamer=e;i;){if(this.current_region){if(i===this.current_region.escape_char){i=e.next();continue}if(this.region_end(this.current_region)){this.current_token=this.current_token.parent,this.current_region=this.current_region.parent,i=e.next();continue}}n=t.find(this.current_region,e),n?(this.parse_region(n),n.keepend&&this.stack.push({token:this.current_token,region:n})):i<=" "?this.handle_new_line(i):i>="0"&&i<="9"?this.parse_number():-1===this.SPECIAL_CHARACTERS.indexOf(i)?this.parse_identifier():this.parse_special_character(),i=e.next()}return this.tokens},parse_number:function(){var e,t=this.streamer;for(this.prepare_new_token(t.current_index),e=t.next();e>="0"&&e<="9";e=t.next());this.add_token(this.make_token("Number")),this.streamer.current_index-=1},SPECIAL_CHARACTERS:[",",".",";",":","<",">","~","`","!","@","#","|","%","^","&","*","(",")","-","+","=","[","]","/","?",'"',"{","}","_","'","\\"].join(""),parse_identifier:function(){var e,t=this.streamer;for(this.prepare_new_token(t.current_index),e=t.next();e>" "&&-1===this.SPECIAL_CHARACTERS.indexOf(e);e=t.next());this.add_token(this.make_token("Identifier")),t.current_index-=1},parse_region:function(e){var t,n,i,r,s=this.streamer;if(this.prepare_new_token(s.current_index),e.start&&(s.current_index+=e.start.length),e.contains)return r=this.make_token(e.type,e.name),r.children=[],this.current_token?(e.parent=this.current_region,r.parent=this.current_token,this.current_token.children.push(r)):this.tokens.push(r),this.current_token=r,this.current_region=e,void(e.start&&(s.current_index-=1));for(i=s.current();i;)if(this.handle_new_line(i),i!==e.escape_char){if(e.skip&&i===e.skip.charAt(0)){for(t=1,n=!0;t<e.skip.length;++t)if(s.peek(s.current_index+t)!==e.skip.charAt(t)){n=!1;break}if(n){s.current_index+=e.skip.length,i=s.current();continue}}if(this.region_end(e,!0))return;i=s.next()}else s.current_index+=2,i=s.current()},parse_special_character:function(){!this.current_region||this.current_region.contains_chars&&-1!==this.current_region.contains_chars.indexOf(this.streamer.current())||(this.prepare_new_token(this.streamer.current_index),this.streamer.current_index+=1,this.make_token("SpecialCharacter").error_unexpected_token()),this.prepare_new_token(this.streamer.current_index),this.streamer.current_index+=1,this.add_token(this.make_token("SpecialCharacter")),this.streamer.current_index-=1},region_end:function(e,t){var n=0;if(this.is_array(e.end))for(;n<e.end.length;++n)if(this.check_end_token(e,e.end[n],t))return this.finallzie_region(e),!0;return this.check_end_token(e,e.end,t)?(this.finallzie_region(e),!0):!!this.region_end_stack(e,t)||void 0},finallzie_region:function(e){for(var t=0;t<this.stack.length;++t)this.stack[t].region===e&&(this.current_token=this.stack[t].token,this.current_region=this.stack[t].region,this.stack.splice(t,this.stack.length))},region_end_stack:function(e,t){for(var n,i=this.stack.length-1;i>=0;--i)if(this.is_array(this.stack[i].region.end)){for(n=0;n<this.stack[i].region.end.length;++n)if(this.check_end_token(e,this.stack[i].region.end[n],t))return this.finallzie_region(this.stack[i].region),!0}else if(this.check_end_token(e,this.stack[i].region.end,t))return this.finallzie_region(this.stack[i].region),!0},check_end_token:function(e,t,n){var i=1,r=this.streamer;if(r.current()===t.charAt(0)){for(;i<t.length;++i)if(r.peek(r.current_index+i)!==t.charAt(i))return!1;if(e.until||(r.current_index+=t.length),n){var s=this.make_token(e.type,e.name);this.set_value(s,e.start?e.start.length:0,e.until?0:t.length),this.add_token(s)}else this.set_end(this.current_token),this.set_value(this.current_token,e.start?e.start.length:0,e.until?0:t.length);return r.current_index-=1,!0}},handle_new_line:function(e){"\r"!==e&&"\n"!==e||this.new_line()},new_line:function(){this.lines.push({number:this.lines.length+1,index:this.streamer.current_index+1})},set_value:function(e,t,n){e.value=this.streamer.seek(e.start.index+t,e.end.index-e.start.index-t-n)},set_end:function(e){e.end={line:this.lines.length,column:this.streamer.current_index-this.lines[this.lines.length-1].index,index:this.streamer.current_index}},prepare_new_token:function(e){this.start={line:this.lines.length,column:e-this.lines[this.lines.length-1].index+1,index:e}},add_token:function(e){this.current_token?this.current_token.children.push(e):this.tokens.push(e)},make_token:function(e,t){var n=this.start.index,r=this.streamer.current_index-this.start.index,s=new i;return s.type=e,s.name=t||e,s.value=this.streamer.seek(n,r),s.start=this.start,s.end={line:this.lines.length,column:this.streamer.current_index-this.lines[this.lines.length-1].index+1,virtual_column:this.lines.column,index:this.streamer.current_index},s}};var a=function(e,t){this.regions=t||new this.Regions,this.language=e,this.global_null_regions=[],this.contained_null_regions=[]};a.prototype={Regions:s,Tokenizer:a,StringStream:h,LexicalParser:o,inherit:function(e){return new this.Tokenizer(e,this.regions.$copy())},parse:function(e){var t=new this.LexicalParser,n=new this.StringStream(e);return t.parse(n,this.regions)}},n.namespace("tokenizer.Token",function(){return i}).namespace("tokenizer.Regions",function(){return s}).namespace("tokenizer.LexicalParser",function(){return o}).namespace("tokenizer.Tokenizer",function(){return a})})}(window.jeefo,window,document);